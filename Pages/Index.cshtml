@page
@model IndexModel
@{
    ViewData["Title"] = "AmigoSecreto .NET";
}

<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>
    <!-- Preconnect for faster font loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Modern Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Custom Dark Theme -->
    <link href="~/css/dark-theme.css" rel="stylesheet" />
</head>

<body>
    <div class="container-fluid main-container">
        <!-- ✨ Premium Header -->
        <header class="header-section">
            <div class="row align-items-center">
                <div class="col">
                    <h1 class="main-title">
                        <i class="fas fa-gift"></i>
                        AmigoSecreto .NET
                    </h1>
                    <p class="subtitle">
                        <i class="fas fa-sparkles me-2"></i>
                        Sistema inteligente de sorteio com envio automático de SMS
                    </p>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="row g-4">
            <!-- Left Column -->
            <div class="col-lg-6">

                <!-- 1. Message Template -->
                <section class="glass-card mb-4" id="message-section">
                    <div class="card-header">
                        <h3><i class="fas fa-comment-dots me-2"></i>Mensagem</h3>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="messageTemplate" class="form-label">Template da Mensagem</label>
                            <textarea class="form-control" id="messageTemplate" rows="5"
                                placeholder="Digite sua mensagem aqui...&#10;&#10;Use as tags:&#10;{NOME} - Nome de quem recebe a mensagem&#10;{AMIGO} - Nome de quem foi sorteado&#10;{PRESENTE} - O que o amigo quer ganhar"></textarea>
                            <div class="d-flex justify-content-between mt-2">
                                <div class="form-text">
                                    <span class="badge bg-info me-2">{NOME}</span>
                                    <span class="badge bg-info me-2">{AMIGO}</span>
                                    <span class="badge bg-info">{PRESENTE}</span>
                                </div>
                                <div>
                                    <span id="charCount" class="char-counter">0 caracteres</span>
                                    <span id="smsCount" class="ms-2 sms-counter">0 SMS</span>
                                </div>
                            </div>
                            <div id="charWarning" class="alert alert-warning mt-2 d-none">
                                <i class="fas fa-exclamation-triangle"></i> Mensagem ultrapassa 160 caracteres
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 2. Contact Input -->
                <section class="glass-card mb-4" id="contact-input-section">
                    <div class="card-header">
                        <h3><i class="fas fa-users me-2"></i>Entrada de Contatos</h3>
                    </div>
                    <div class="card-body">
                        <ul class="nav nav-tabs mb-3" id="inputTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="csv-tab" data-bs-toggle="tab"
                                    data-bs-target="#csv-panel" type="button">
                                    <i class="fas fa-file-csv me-1"></i> Upload CSV
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="text-tab" data-bs-toggle="tab" data-bs-target="#text-panel"
                                    type="button">
                                    <i class="fas fa-keyboard me-1"></i> Colar Texto
                                </button>
                            </li>
                        </ul>

                        <div class="tab-content" id="inputTabContent">
                            <!-- CSV Upload -->
                            <div class="tab-pane fade show active" id="csv-panel">
                                <div class="mb-3">
                                    <label for="csvFile" class="form-label">Arquivo CSV</label>
                                    <input type="file" class="form-control" id="csvFile" accept=".csv">
                                    <div class="form-text">
                                        Formato esperado: <code>nome;celular;presente</code>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-primary w-100" id="loadCsvBtn">
                                    <i class="fas fa-upload me-2"></i>Carregar CSV
                                </button>
                            </div>

                            <!-- Text Input -->
                            <div class="tab-pane fade" id="text-panel">
                                <div class="mb-3">
                                    <label for="textInput" class="form-label">Cole os contatos</label>
                                    <textarea class="form-control" id="textInput" rows="8"
                                        placeholder="Cole aqui no formato:&#10;nome;celular;presente&#10;&#10;Exemplo:&#10;João;5511999999999;Livro&#10;Maria;5511888888888;Boneca"></textarea>
                                </div>
                                <button type="button" class="btn btn-primary w-100" id="loadTextBtn">
                                    <i class="fas fa-paste me-2"></i>Carregar Contatos
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

            </div>

            <!-- Right Column -->
            <div class="col-lg-6">

                <!-- 1. Recipients Table -->
                <section class="glass-card mb-4" id="recipients-section">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h3><i class="fas fa-table me-2"></i>Contatos Carregados</h3>
                        <button type="button" class="btn btn-sm btn-outline-danger" id="clearTableBtn">
                            <i class="fas fa-trash me-1"></i>Limpar Todos
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="recipientsTableContainer">
                            <p class="text-muted text-center py-4">
                                <i class="fas fa-inbox fa-3x mb-3 d-block"></i>
                                Nenhum contato carregado ainda
                            </p>
                        </div>
                    </div>
                </section>

                <!-- 2. Validation and Preview -->
                <section class="glass-card mb-4" id="validation-section">
                    <div class="card-header">
                        <h3><i class="fas fa-check-circle me-2"></i>Validação e Preview</h3>
                    </div>
                    <div class="card-body">
                        <div class="row g-2 mb-3">
                            <div class="col-6">
                                <button type="button" class="btn btn-info w-100" id="validateBtn" disabled>
                                    <i class="fas fa-shield-alt me-2"></i>Validar Apenas
                                </button>
                            </div>
                            <div class="col-6">
                                <button type="button" class="btn btn-success w-100" id="previewBtn" disabled>
                                    <i class="fas fa-eye me-2"></i>Validar + Preview
                                </button>
                            </div>
                        </div>

                        <div id="validationResult" class="mt-3"></div>
                        <div id="previewContainer" class="mt-3"></div>
                    </div>
                </section>

                <!-- 3. API Configuration -->
                <section class="glass-card mb-4" id="api-config-section">
                    <div class="card-header">
                        <h3><i class="fas fa-key me-2"></i>Configuração da API</h3>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="apiKey" class="form-label">API Key da Comtele</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                <input type="password" class="form-control" id="apiKey" autocomplete="off"
                                    placeholder="Insira sua API Key">
                                <button class="btn btn-outline-secondary" type="button" id="toggleApiKey">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="form-text">
                                <i class="fas fa-info-circle"></i> A chave não será armazenada
                            </div>
                            <div id="apiKeyStatus" class="mt-2"></div>
                        </div>
                    </div>
                </section>

                <!-- 4. Send SMS -->
                <section class="glass-card mb-4" id="send-section">
                    <div class="card-header">
                        <h3><i class="fas fa-rocket me-2"></i>Enviar SMS</h3>
                    </div>
                    <div class="card-body">
                        <button type="button" class="btn btn-lg btn-gradient w-100" id="sendSmsBtn" disabled>
                            <i class="fas fa-paper-plane me-2"></i>Enviar SMS
                        </button>

                        <div id="sendProgress" class="mt-3 d-none">
                            <div class="progress mb-2" style="height: 25px;">
                                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"
                                    id="sendProgressBar" style="width: 0%">0%</div>
                            </div>
                            <div id="sendStatus"></div>
                        </div>

                        <div id="sendResults" class="mt-3"></div>
                    </div>
                </section>

            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js"></script>
</body>

</html>